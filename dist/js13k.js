function startState(){var t={t:"The",f:"65px Sans-serif",c:"#FFF"},e={t:"Keeper",f:"70px Sans-serif",c:"#FFF"},n={t:"Click the circle to start",f:"30px Sans-serif",c:"#F0F0F0"};return{create:function(){textWidth([t,e,n]),configLvl(0,200,[-200,-150],-1,1,200,!1,[{x:cnv.width/2,y:cnv.height/2+50,r:150,tmp:1}])},update:function(){fillText(t,cnv.width/2-t.w/2,90),fillText(e,cnv.width/2-e.w/2,170),fillText(n,cnv.width/2-n.w/2,cnv.height-10)},finish:function(){switchState(INTRO_STATE)}}}function introState(){function t(){tmp>=70&&n(),fillText(r,center(r.w,cnv.width),100),fillText(a,center(a.w,cnv.width),210),fillText(s,center(s.w,cnv.width),390),drawSquare(center(s.w+90,cnv.width),300,s.w+90,110)}function e(){tmp<=-70&&n(),fillText(o,center(o.w,cnv.width)-30,100),fillText(h,center(h.w,cnv.width)+30,180),ctx.fillRect(0,230,cnv.width,5),fillText(f,center(f.w,cnv.width),350),fillText(u,center(u.w,cnv.width),450),fillText(d,center(d.w,cnv.width),510),drawSquare(center(u.w+90,cnv.width),395,u.w+90,140)}function n(){v+=1,1==v&&(i=-1.5),v>=x.length&&switchState(LEVEL1_STATE)}var i=.5,c=["loading propulsors","detecting user mood","cleaning dishes","preparing coffee","taking nap pills","asking for indications","writing a song","holding breath","thinking a joke","flirting with OS"],l=null,r={f:"70px Sans-serif",t:"Hi",c:"#FDFDFD"},a={t:"keeper",f:"85px Sans-serif",c:"#FDFDFD"},s={t:"",f:"95px Sans-serif",c:"#F0F0F0"},o={t:"Skills",f:"80px Sans-serif",c:"#FAFAFA"},h={t:"Tests",f:"80px Sans-serif",c:"#FAFAFA"},f={t:"Step 1:",f:"60px Sans-serif",c:"#FAFAFA"},u={t:"Cold the room",f:"40px Sans-serif",c:"#FAFAFA"},d={t:"-100°C < t < -10°C",f:"35px Sans-serif",c:"#FAFAFA"},v=0,x=[t,e];return{create:function(){if("undefined"!=typeof Storage){var t=localStorage.getItem("keeper-nick");t?r.t="Hi again":(r.t="Hi",t=genNick(),localStorage.setItem("keeper-nick",t)),s.t=t}l={t:c[Math.floor(Math.random(c.length)*c.length)],f:"40px Sans-serif",c:"#F0F0F0"},textWidth([r,a,s,o,h,f,u,d,l]),configLvl(-70,200,[-70,70],null,null,null,!1,null)},update:function(){tmp+=i,x[v](),0==v?0==Math.abs(tmp%50)&&(l.t=c[Math.floor(Math.random(c.length)*c.length)],textWidth(l)):(l.t="prepare to start",textWidth(l)),fillText(l,center(l.w,cnv.width),cnv.height-5)}}}function testState(){var t=70,e=100,n=[-100,-10],i=null,c=null,l=0,r=0,a=null,s=!1,o={text:"Temperature restored",font:"60px Sans-serif",color:"#FDFDFD"},h={text:"saved species",font:"40px Sans-serif",color:"#F0F0F0"},f={text:"Time is over",font:"60px Sans-serif",color:"#D6990B"};return{create:function(){c=5,r=25,circles.push(new Circle(context,200,canvas.width/2,canvas.height/2,0,{r:255,g:0,b:0},12,2e3,30)),setTextWidth(o),setTextWidth(h),setTextWidth(f),a=setInterval(function(){!s&&r>0&&r--},1e3)},update:function(){if(clearCanvas(),drawTimeBar(c-l,r,null!=i),s||0==r)for(var a=0;a<circles.length;a++)circles[a].ball.speed=0,circles[a].listenClicks=!1;drawCircles(),!s&&r>0&&(t+=calculateDeltaTemperature()),Math.abs(t)>e&&(t=0>t?-1*e:e),drawMoveableTemperature(t,e),drawTemperatureBar(t,e),drawTemperatureText(t),drawTemperatureRange(n,e),t<=n[1]&&t>=n[0]&&(i=i||setInterval(this.increaseTimeInRange,1e3)),s&&(fillText(o,center(o.width,canvas.width),canvas.height/2),fillText(h,center(h.width,canvas.width),canvas.height/2+70)),s||0!=r||fillText(f,center(f.width,canvas.width),canvas.height/2)},destroy:function(){circles=[]},increaseTimeInRange:function(){!s&&r>0&&l++,l>=c&&(s=!0)}}}function lerp(t,e,n){return(1-n)*t+n*e}function getRGBText(t){return"rgb("+t.r+","+t.g+","+t.b+")"}function fade(t,e,n,i){var c=100,l=i/c,r=1/l,a=0,s=setInterval(function(){return a>=1?void clearInterval(s):(t.r=Math.round(lerp(e.r,n.r,a)),t.g=Math.round(lerp(e.g,n.g,a)),t.b=Math.round(lerp(e.b,n.b,a)),void(a+=r))},c);return s}function deltaTmp(){for(var t=0,e=0;e<circles.length;e++)t+=circles[e].temperatureSpeed;return t}function textWidth(t){t.length||(t=[t]),t.forEach(function(t){ctx.font=t.f,t.w=ctx.measureText(t.t).width})}function fillText(t,e,n){ctx.fillStyle=t.c,ctx.font=t.f,ctx.fillText(t.t,e,n)}function center(t,e){return e/2-t/2}function genNick(){var t=Date.now();return"K"+t%1e3+String.fromCharCode(t%10+65)}function drawTriangle(t,e){ctx.fillStyle=getRGBText(e),ctx.lineWidth=2,ctx.lineCap="square",ctx.beginPath(),ctx.moveTo(t-10,cnv.height-60),ctx.lineTo(t,cnv.height-40),ctx.lineTo(t+10,cnv.height-60),ctx.lineTo(t-10,cnv.height-60),ctx.fill(),ctx.closePath()}function drawSquare(t,e,n,i){ctx.strokeStyle="#FDFDFD",ctx.lineCap="square",ctx.lineWidth=6,ctx.strokeRect(t,e,n,i)}function eventWindowLoaded(){var t=document.getElementById("canvas13K");t.width=window.innerWidth,t.height=window.innerHeight,init()}function init(){cnv=document.getElementById("canvas13K"),cnv&&cnv.getContext&&(ctx=cnv.getContext("2d"),cnv.addEventListener("click",function(t){onMouseClick(t)},!1),switchState(INTRO_STATE),setInterval(function(){updateLvl(33)},33))}function onMouseClick(t){mouseX=t.clientX-cnv.offsetLeft,mouseY=t.clientY-cnv.offsetTop;for(var e=0;e<circles.length;e++)circles[e].checkClick(mouseX,mouseY)}function clearCanvas(){ctx.fillStyle="#191919",ctx.fillRect(0,0,cnv.width,cnv.height)}var Circle=function(t,e,n,i,c,l,r,a,s){var o=2*Math.PI*e,h=o/(a/33);this.ball={x:0,y:0,speed:360/(o/h)*(Math.PI/180)};var f=Math.pow(n+(e-(r-r/2))-n,2),u=Math.sqrt(f),d=Math.pow(n+(e+(r-r/2))-n,2),v=Math.sqrt(d),x=null;this.color=l,this.temperatureSpeed=33*s/a,this.listenClicks=!0,this.draw=function(){t.beginPath(),t.strokeStyle=getRGBText(l),t.lineWidth=r,t.arc(n,i,e,0,2*Math.PI,!0),t.stroke(),t.closePath(),this.ball.x=n+Math.cos(c)*e,this.ball.y=i+Math.sin(c)*e,c+=this.ball.speed,t.fillStyle=getRGBText(l),t.beginPath(),t.arc(this.ball.x,this.ball.y,15,0,2*Math.PI,!0),t.closePath(),t.fill()},this.checkClick=function(t,e){if(1==this.listenClicks){var c=Math.pow(n-t,2),l=Math.pow(i-e,2),r=Math.sqrt(c+l);if(r>=u&&v>=r){clearInterval(x);var a=this.color,s=null;s=this.ball.speed>0?{r:0,g:0,b:255}:{r:255,g:0,b:0},x=fade(this.color,a,s,2e3),this.ball.speed*=-1,this.temperatureSpeed*=-1}}},this.drawDebug=function(){t.fillStyle="blue",t.beginPath(),t.arc(n,i,1,0,2*Math.PI,!0),t.closePath(),t.fill(),t.fillStyle="blue",t.beginPath(),t.arc(n+e+(r-r/2),i,1,0,2*Math.PI,!0),t.arc(n+e-(r-r/2),i,1,0,2*Math.PI,!0),t.closePath(),t.fill()}};window.addEventListener("load",eventWindowLoaded,!1);var START_STATE=0,LEVEL1_STATE=1,INTRO_STATE=2,cnv=null,ctx=null,circles=[],mouseX=null,mouseY=null,currentGameState=0,currentGameStateFunction=null,barColor={r:255,g:255,b:255},stateObj=null,gameStates=[startState,testState,introState];