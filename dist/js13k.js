function startState(){function t(){drawSquare(3,3,103,53,"#4DBF00"),drawSquare(cnv.width-103,3,100,50,"#F00"),l.t=""+savedWorlds,textWidth(l),fillText(l,center(l.w/2,100),40),l.t=""+lostWorlds,textWidth(l),fillText(l,center(l.w/2,100)+cnv.width-110,40)}var e={t:"The",f:"65px Sans-serif",c:"#FFF"},n={t:"Keeper",f:"70px Sans-serif",c:"#FFF"},i={t:"Click the circle to start",f:"30px Sans-serif",c:"#F0F0F0"},l={t:"",f:"30px Sans-serif",c:"#FFF"};return{create:function(){"undefined"!=typeof Storage&&(savedWorlds=parseInt(localStorage.getItem("keeper-saved"))||0,lostWorlds=parseInt(localStorage.getItem("keeper-lost"))||0),textWidth([e,n,i]),configLvl(0,200,[-200,-150],null,1,200,!1,!1,!1,!1,!1,[{x:cnv.width/2,y:cnv.height/2+50,r:150,tmp:1}])},update:function(){fillText(e,cnv.width/2-e.w/2,90),fillText(n,cnv.width/2-n.w/2,170),fillText(i,cnv.width/2-i.w/2,cnv.height-10),t()},finish:function(){switchState(INTRO_STATE)}}}function savedWorldsInfo(){"undefined"!=typeof localStorage&&(localStorage.setItem("keeper-saved",savedWorlds),localStorage.setItem("keeper-lost",lostWorlds))}function introState(){var t=0,e=.5,n=["loading propulsors","detecting user mood","cleaning dishes","preparing coffee","taking nap pills","asking for indications","writing a song","holding breath","thinking a joke","flirting with OS"],i=null,l={f:"70px Sans-serif",t:"Hi",c:"#FDFDFD"},a={t:"keeper",f:"85px Sans-serif",c:"#FDFDFD"},r={t:"",f:"95px Sans-serif",c:"#F0F0F0"};return{create:function(){if("undefined"!=typeof Storage){var e=localStorage.getItem("keeper-nick");e?(l.t="Hi again",firstTime=!1):(l.t="Hi",e=genNick(),localStorage.setItem("keeper-nick",e)),t=parseInt(localStorage.getItem("keeper-tutorial")),r.t=e}i={t:n[Math.floor(Math.random(n.length)*n.length)],f:"40px Sans-serif",c:"#F0F0F0"},textWidth([l,a,r,i]),configLvl(-70,200,[-70,70],null,null,null,!1,!1,!1,!1,!1,null)},update:function(){return tmp>=70?void this.finish():(tmp+=e,0==Math.abs(tmp%50)&&(i.t=n[Math.floor(Math.random(n.length)*n.length)],textWidth(i)),fillText(l,center(l.w,cnv.width),100),fillText(a,center(a.w,cnv.width),210),fillText(r,center(r.w,cnv.width),390),drawSquare(center(r.w+90,cnv.width),300,r.w+90,110,"#FDFDFD"),void fillText(i,center(i.w,cnv.width),cnv.height-5))},finish:function(){3>=t?switchState(SKILL1_STATE+t-1):switchState(LVLGEN_STATE)}}}function lvl1State(){return{repeat:!0,lifes:1,create:function(){configLvl(70,100,[-100,-10],25,5,30,!0,!0,!0,!0,!0,[{x:cnv.width/2,y:cnv.height/2,r:200,tmp:1}])},update:function(){},finish:function(){},wonClick:function(){switchState(SKILL2_STATE)},lostClick:function(){this.create()}}}function lerp(t,e,n){return(1-n)*t+n*e}function getRGBText(t){return"rgb("+t.r+","+t.g+","+t.b+")"}function fade(t,e,n,i){var l=100,a=i/l,r=1/a,c=0,o=setInterval(function(){return c>=1?void clearInterval(o):(t.r=Math.round(lerp(e.r,n.r,c)),t.g=Math.round(lerp(e.g,n.g,c)),t.b=Math.round(lerp(e.b,n.b,c)),void(c+=r))},l);return o}function deltaTmp(){for(var t=0,e=0;e<circles.length;e++)t+=circles[e].temperatureSpeed;return t}function textWidth(t){t.length||(t=[t]),t.forEach(function(t){ctx.font=t.f,t.w=ctx.measureText(t.t).width})}function fillText(t,e,n){ctx.fillStyle=t.c,ctx.font=t.f,ctx.fillText(t.t,e,n)}function center(t,e){return e/2-t/2}function genNick(){var t=Date.now();return"K"+t%1e3+String.fromCharCode(t%10+65)}function drawTriangle(t,e){ctx.fillStyle=getRGBText(e),ctx.lineWidth=2,ctx.lineCap="square",ctx.beginPath(),ctx.moveTo(t-10,cnv.height-60),ctx.lineTo(t,cnv.height-40),ctx.lineTo(t+10,cnv.height-60),ctx.lineTo(t-10,cnv.height-60),ctx.fill(),ctx.closePath()}function drawSquare(t,e,n,i,l){ctx.strokeStyle=l,ctx.lineCap="square",ctx.lineWidth=6,ctx.strokeRect(t,e,n,i)}function calculateTFL(t){return 10*t}function calculateCirclePos(t){return{x:getRandomInt(t+5,cnv.width-5-t),y:getRandomInt(cnv.height-(cnv.height-45)+t,cnv.height-45-t)}}function calculateTempRange(t){var e=getRandomInt(-t+10,t-10),n=getRandomInt(e+40,e+60);return n>=t-10&&(n=e,e=getRandomInt(n-60,n-40)),[e,n]}function calculateInitTemp(t,e){var n=0;do n=Math.abs(-e-t[0])>e-t[1]?getRandomInt(-e-10,t[0]-10):getRandomInt(t[1]+10,e-10);while(-e>n||n>e);return n}function calculateTimeRange(t,e,n,i){var l=0;return t.forEach(function(t){l+=calculateTFL(t.r)/e}),l/=t.length,l=Math.floor(l*(n[1]-n[0])/1e3),1>=l&&(l=2),l}function calculateTimeLvl(t,e,n){var i=0;i=Math.abs(e-n[0])<Math.abs(e-n[1])?Math.abs(e-n[0]):Math.abs(e-n[1]);var l=Math.floor(i*t/(n[1]-n[0]));return 3>=l&&(l=4),l+=getRandomInt(l+2,l+5)}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function getRandomArbitrary(t,e){return Math.random()*(e-t)+t}function eventWindowLoaded(){var t=document.getElementById("canvas13K");t.width=window.innerWidth>480?480:window.innerWidth,t.style.left=window.innerWidth/2-t.width/2+"px",t.height=window.innerHeight,init()}function init(){cnv=document.getElementById("canvas13K"),cnv&&cnv.getContext&&(ctx=cnv.getContext("2d"),cnv.addEventListener("click",function(t){onMouseClick(t)},!1),initLvl(),switchState(SKILL3_STATE),setInterval(function(){updateLvl(),mouseX=mouseY=null},33))}function onMouseClick(t){mouseX=t.clientX-cnv.offsetLeft,mouseY=t.clientY-cnv.offsetTop}function getClick(){return mouseX&&mouseY?{x:mouseX,y:mouseY}:null}function clearCanvas(){ctx.fillStyle="#191919",ctx.fillRect(0,0,cnv.width,cnv.height)}var Circle=function(t,e,n,i,l,a,r,c,o){var h=2*Math.PI*e,s=h/(c/33);this.ball={x:0,y:0,speed:360/(h/s)*(Math.PI/180)*(0==a?-1:1)};var u=Math.pow(n+(e-(r-r/2))-n,2),f=Math.sqrt(u),d=Math.pow(n+(e+(r-r/2))-n,2),g=Math.sqrt(d),v=null;this.color={r:255,g:0,b:0},0==a&&(this.color={r:0,g:0,b:255}),this.temperatureSpeed=33*o/c*(0==a?-1:1),this.listenClicks=!0,this.draw=function(){t.beginPath(),t.strokeStyle=getRGBText(this.color),t.lineWidth=r,t.arc(n,i,e,0,2*Math.PI,!0),t.stroke(),t.closePath(),this.ball.x=n+Math.cos(l)*e,this.ball.y=i+Math.sin(l)*e,l+=this.ball.speed,t.fillStyle=getRGBText(this.color),t.beginPath(),t.arc(this.ball.x,this.ball.y,15,0,2*Math.PI,!0),t.closePath(),t.fill(),this.listenClicks||(t.strokeStyle="#313131",t.setLineDash([1]),t.lineWidth=r+1,t.beginPath(),t.arc(n,i,e,0,Math.PI/180*315,!0),t.stroke(),t.closePath(),t.beginPath(),t.arc(n,i,e,Math.PI/180*180,Math.PI/180*135,!0),t.stroke(),t.closePath())},this.checkClick=function(t,e){if(1==this.listenClicks){var l=Math.pow(n-t,2),a=Math.pow(i-e,2),r=Math.sqrt(l+a);if(r>=f&&g>=r){clearInterval(v);var c=this.color,o=null;return o=this.ball.speed>0?{r:0,g:0,b:255}:{r:255,g:0,b:0},v=fade(this.color,c,o,2e3),this.ball.speed*=-1,this.temperatureSpeed*=-1,this.listenClicks=!1,!0}}return!1},this.drawDebug=function(){t.fillStyle="blue",t.beginPath(),t.arc(n,i,1,0,2*Math.PI,!0),t.closePath(),t.fill(),t.fillStyle="blue",t.beginPath(),t.arc(n+e+(r-r/2),i,1,0,2*Math.PI,!0),t.arc(n+e-(r-r/2),i,1,0,2*Math.PI,!0),t.closePath(),t.fill()}};window.addEventListener("load",eventWindowLoaded,!1);var START_STATE=0,INTRO_STATE=1,LVLGEN_STATE=2,SKILL1_STATE=3,SKILL2_STATE=4,SKILL3_STATE=5,LEVEL1_STATE=6,LEVEL2_STATE=7,LEVEL3_STATE=8,cnv=null,ctx=null,circles=[],mouseX=null,mouseY=null,currentGameState=0,currentGameStateFunction=null,barColor={r:255,g:255,b:255},stateObj=null,gameStates=[startState,introState,lvlgenState,skillState.bind(null,1,"Cool The Room",LEVEL1_STATE),skillState.bind(null,2,"Now keep it!",LEVEL2_STATE),skillState.bind(null,3,"Touch them together",LEVEL3_STATE),lvl1State,lvl2State,lvl3State];